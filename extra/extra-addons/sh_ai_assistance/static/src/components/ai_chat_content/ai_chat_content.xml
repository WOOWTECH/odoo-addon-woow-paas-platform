<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="sh_ai_assistance.AiChatContentTemplate">
        <div class="o-ai-ChatContent d-flex flex-column h-100 flex-grow-1">
            <!-- Messages Area with Scroll Navigation -->
            <div class="messages-area-container flex-grow-1">
                <div class="o-ai-ChatMessages h-100 overflow-auto p-4" t-ref="messagesContainer">
                    <t t-if="state.messages.length === 0">
                        <div class="ai-empty-state">
                            <!-- AI Avatar and Welcome -->
                            <div class="ai-welcome-section">
                                <div class="ai-avatar-container">
                                    <t t-if="props.selectedModel and props.selectedModel.image and props.selectedModel.id">
                                        <img class="ai-welcome-avatar"
                                             t-att-src="'/web/image/sh.ai.llm/' + props.selectedModel.id + '/image'"
                                             t-att-alt="props.selectedModel.name"/>
                                    </t>
                                    <t t-else="">
                                        <div class="ai-welcome-avatar ai-default-welcome-avatar">
                                            <span class="ai-icon">AI</span>
                                        </div>
                                    </t>
                                </div>

                                <div class="ai-welcome-text">
                                    <h2 class="ai-welcome-title">
                                        <t t-if="props.selectedModel and props.selectedModel.name">
                                            <t t-esc="props.selectedModel.name"/>
                                        </t>
                                        <t t-else="">
                                            Ask AI
                                        </t>
                                    </h2>
                                    <p class="ai-welcome-subtitle">Hello, what can I help you with?</p>
                                </div>
                            </div>

                            <!-- Demo Questions -->
                            <div class="ai-demo-questions">
                                <h3 class="ai-demo-title">Try asking:</h3>
                                <div class="ai-question-cards">
                                    <t t-foreach="question_list" t-as="question" t-key="question">
                                        <button  class="ai-question-card"
                                                t-on-click="() => this.selectDemoQuestion(question)">
                                            <div class="question-bulb-icon">
                                                <i class="fa fa-lightbulb-o"></i>
                                            </div>
                                            <div class="ai-question-content">
                                                <span class="ai-question-text"><t t-esc="question"/></span>
                                            </div>
                                        </button>
                                    </t>
                                </div>
                            </div>
                        </div>
                    </t>

                    <t t-foreach="state.messages" t-as="message" t-key="message_index">
                        <ChatMessage message="message"
                                   messageIndex="message_index"
                                   currentUser="currentUser"
                                   currentLlm="props.selectedModel"
                                   availableModels="props.availableModels"/>
                    </t>

                    <t t-if="isProcessing">
                        <AiTypingIndicator
                            currentLlm="props.selectedModel"
                            currentUser="currentUser"/>
                    </t>
                </div>

            </div>

            <!-- Enhanced Input Area -->
            <div class="o-ai-ChatInput enhanced-chat-input">
                <div class="input-container">
                    <!-- User Avatar -->
                    <div class="user-avatar-section">
                        <t t-if="currentUser.id and currentUser.id !== 'undefined'">
                            <img class="user-avatar"
                                 t-att-src="'/web/image/res.users/' + currentUser.id + '/avatar_128'"
                                 t-att-alt="currentUser.name"/>
                        </t>
                        <t t-else="">
                            <div class="user-avatar default-avatar">
                                <i class="fa fa-user"/>
                            </div>
                        </t>
                    </div>

                    <!-- Input Field Area -->
                    <div class="input-field-area">
                        <div class="input-wrapper">
                            <textarea class="enhanced-textarea"
                                      placeholder="Ask me anything about your database..."
                                      t-model="state.currentQuery"
                                      t-on-keypress="onKeyPress"
                                      t-on-input="onInputChange"
                                      t-ref="textInput"
                                      t-att-disabled="isProcessing"
                                      rows="1"></textarea>

                            <!-- Character Counter -->
                            <div t-if="state.currentQuery.length > 100" class="char-counter">
                                <t t-esc="state.currentQuery.length"/>/10000
                            </div>

                            <!-- Shift+Enter Hint -->
                            <div t-if="state.showShiftEnterHint" class="hint-tooltip">
                                Press Shift+Enter for new line
                            </div>
                        </div>
                    </div>

                    <!-- Send Button -->
                    <div class="send-button-section">
                        <button class="enhanced-send-button"
                                t-att-class="isProcessing ? 'processing' : (state.currentQuery.trim() ? 'ready' : 'disabled')"
                                type="button"
                                t-on-click="sendMessage"
                                t-att-disabled="isProcessing or !state.currentQuery.trim()">

                            <i t-if="!isProcessing" class="fa fa-paper-plane"/>
                            <i t-if="isProcessing" class="fa fa-spinner fa-spin"/>
                        </button>
                    </div>
                </div>

                <!-- Provider Warning Message -->
                <div t-if="providerWarningMessage" class="py-1 text-center" style="font-size: 11px; color: #6c757d;">
                    <i class="fa fa-exclamation-triangle me-1" style="font-size: 10px; color: rgb(255, 0, 0);"/>
                    <t t-esc="providerWarningMessage"/><span class="o_tooltip" data-tooltip="If you encounter inaccurate or unexpected results. Try starting a fresh conversation create a new chat session and continue your interaction from there." style="font-size: 10px; color:rgb(212, 202, 0); cursor: pointer;">Tips <i class="fa fa-lightbulb-o"></i></span> 
                </div>
            </div>
        </div>
    </t>
</templates>