---
name: End-to-end integration test
status: open
created: 2026-02-27T14:18:57Z
updated: 2026-02-27T14:31:13Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/112
depends_on: [003, 004, 005, 006, 007]
parallel: false
conflicts_with: []
---

# Task: End-to-end integration test

## Description
執行完整的端到端測試流程：部署 n8n Cloud Service → 驗證 MCP sidecar 啟動 → 驗證 MCP Server 自動建立 → 驗證 tool discovery → 在 AI Chat 中使用 n8n 工具。

## Acceptance Criteria
- [ ] 部署 n8n Cloud Service 成功（state=running）
- [ ] Pod 中包含 n8n 和 n8n-mcp 兩個 container
- [ ] MCP Server 記錄自動建立（auto_created=True, state=connected）
- [ ] Tool discovery 返回 ≥15 個 n8n 工具
- [ ] AI Chat 中可列出 n8n workflows（調用 n8n_list_workflows tool）
- [ ] AI Chat 中可建立 n8n workflow（調用 n8n_create_workflow tool）
- [ ] 刪除 Cloud Service 後 MCP Server 記錄自動清除
- [ ] 非 MCP 模板的 Cloud Service 部署不受影響

## Technical Details
- 測試環境：K8s cluster + PaaS Operator + Odoo
- 測試步驟：
  1. 確認 n8n 模板 MCP 欄位已正確配置
  2. POST /api/workspaces/{id}/services 建立 n8n service
  3. 輪詢直到 state=running
  4. 驗證 `kubectl get pods` 中 n8n Pod 有 2 個 containers
  5. 驗證 Odoo 中自動建立的 MCP Server 記錄
  6. 驗證 MCP Server state=connected，tool_count ≥ 15
  7. 在 AI Chat channel 中發送 "列出我的 n8n workflows"
  8. 驗證 AI 調用了 n8n_list_workflows tool
  9. 刪除 Cloud Service，驗證 MCP Server cascade delete
- 如果是自動化測試：使用 Odoo test framework + mock PaaS Operator
- 如果是手動測試：記錄測試步驟和截圖

## Dependencies
- [ ] Task 003: Sidecar 注入邏輯
- [ ] Task 004: 自動建立 MCP Server hook
- [ ] Task 005: n8n 模板 MCP 配置
- [ ] Task 006: Sidecar endpoint 可達性
- [ ] Task 007: Health check 和重試機制

## Effort Estimate
- Size: M
- Hours: 6
- Parallel: false（需所有前置 tasks 完成）

## Definition of Done
- [ ] 端到端流程測試通過
- [ ] 至少一個 n8n tool 調用成功（list 或 create workflow）
- [ ] 錯誤場景已測試（sidecar 故障、sync 失敗）
- [ ] 測試結果記錄在 epic 文件中
