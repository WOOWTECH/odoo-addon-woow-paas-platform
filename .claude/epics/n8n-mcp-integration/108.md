---
name: Update n8n template with MCP sidecar configuration
status: open
created: 2026-02-27T14:18:57Z
updated: 2026-02-27T14:31:13Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/108
depends_on: [001, 002]
parallel: true
conflicts_with: []
---

# Task: Update n8n template with MCP sidecar configuration

## Description
更新 n8n CloudAppTemplate 的 XML data 記錄，填入 MCP sidecar 配置（image、port、transport、env vars）。同時為 n8n API Key 自動生成加入必要的 helm_default_values。

## Acceptance Criteria
- [ ] n8n 模板記錄 (`cloud_app_n8n`) 的 MCP 欄位已填入：
  - `mcp_enabled`: True
  - `mcp_sidecar_image`: ghcr.io/czlonkowski/n8n-mcp:{pinned_version}
  - `mcp_sidecar_port`: 3001（或 Task 001 驗證結果）
  - `mcp_transport`: streamable_http（或 Task 001 驗證結果）
  - `mcp_endpoint_path`: /mcp（或 Task 001 驗證結果）
  - `mcp_sidecar_env`: JSON 包含 MCP_MODE、N8N_API_URL 等靜態環境變數
- [ ] n8n-mcp image 使用 pinned version tag（非 latest）
- [ ] n8n helm_default_values 包含 API Key 相關的環境變數配置
- [ ] Module upgrade 後 n8n 模板正確載入新欄位

## Technical Details
- 修改 `src/data/cloud_app_templates.xml` 的 `cloud_app_n8n` record
- n8n-mcp sidecar 環境變數：
  ```json
  {
    "MCP_MODE": "http",
    "N8N_API_URL": "http://localhost:5678"
  }
  ```
  注意：`N8N_API_KEY` 由部署邏輯動態生成，不放在靜態模板中
- Pin n8n-mcp image version：查看 ghcr.io/czlonkowski/n8n-mcp 的 releases，選擇最新穩定版
- helm_default_values 中可能需要加入 n8n 的 API 啟用配置（如 `N8N_PUBLIC_API_DISABLED=false`）

## Dependencies
- [ ] Task 001: 確認 n8n-mcp 的 port、transport、endpoint path
- [ ] Task 002: CloudAppTemplate MCP 欄位已存在

## Effort Estimate
- Size: S
- Hours: 2
- Parallel: true（與 Task 003、004 可並行）

## Definition of Done
- [ ] n8n 模板包含完整 MCP sidecar 配置
- [ ] Module upgrade 不報錯
- [ ] 模板 form view 正確顯示 MCP 設定
