---
name: Handle MCP sidecar endpoint accessibility
status: open
created: 2026-02-27T14:18:57Z
updated: 2026-02-27T14:31:13Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/110
depends_on: [001, 003]
parallel: true
conflicts_with: []
---

# Task: Handle MCP sidecar endpoint accessibility

## Description
確保 Odoo（可能在 Docker 或 K8s 外部）能存取 n8n-mcp sidecar 的 MCP endpoint。可能需要透過 Ingress path routing 或獨立 K8s Service 暴露 sidecar port。

## Acceptance Criteria
- [ ] 確定 MCP sidecar endpoint 的暴露方式（Ingress path / 額外 Service / port-forward）
- [ ] 如需 Ingress：PaaS Operator 的 Cloudflare 路由支援額外 path routing
- [ ] 如需 K8s Service：在部署時自動建立 sidecar 的 ClusterIP Service
- [ ] Odoo 端構建的 MCP URL 可正確連線到 sidecar
- [ ] 支援 Docker Odoo（host.docker.internal）和本機 Odoo（localhost）兩種場景

## Technical Details
- **方案 A：Ingress path routing**（推薦）
  - 主服務：`https://subdomain.domain/` → n8n:5678
  - MCP：`https://subdomain.domain/mcp` → sidecar:3001
  - 需修改 PaaS Operator 的 Cloudflare tunnel 配置以支援 path-based routing
  - 或在 Helm chart 中加入額外的 Ingress rule
- **方案 B：獨立 Service**
  - 建立 `{release}-mcp` K8s Service 指向 sidecar port
  - URL: `http://{release}-mcp.{namespace}.svc.cluster.local:3001/mcp`
  - 只在 K8s 內部可達，需額外 Ingress 或 port-forward
- **方案 C：共用 Service 多 port**
  - 在現有 Service 中加入 sidecar port（3001）
  - 需 Helm chart 支援
- 考慮 Odoo 運行環境：
  - K8s 內部 Odoo → 用 K8s internal URL
  - Docker Odoo → 用 host.docker.internal + port-forward
  - 本機 Odoo → 用 localhost + port-forward
- 修改 `src/controllers/paas.py` 中 MCP URL 構建邏輯

## Dependencies
- [ ] Task 001: 確認 sidecar 的 port 和 endpoint path
- [ ] Task 003: Sidecar 已注入到 Pod

## Effort Estimate
- Size: M
- Hours: 5
- Parallel: true（與 Task 004、005 可並行）

## Definition of Done
- [ ] MCP sidecar endpoint 從 Odoo 可達
- [ ] URL 構建邏輯覆蓋各種 Odoo 運行環境
- [ ] 連線失敗有明確錯誤訊息
