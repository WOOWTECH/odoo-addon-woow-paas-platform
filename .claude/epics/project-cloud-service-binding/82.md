---
name: Model changes - cloud_service_id on project + project_ids on cloud_service
status: open
created: 2026-02-22T06:48:56Z
updated: 2026-02-22T06:53:09Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/82
depends_on: []
parallel: true
conflicts_with: []
---

# Task: Model changes - cloud_service_id on project + project_ids on cloud_service

## Description

修改 `project.project` 和 `woow_paas_platform.cloud_service` 模型，將 project 的關聯從 workspace 改為 cloud service，並確保 1:1 constraint。同時更新 security rules。

## Acceptance Criteria

- [ ] `project.project` 新增 `cloud_service_id` (Many2one → `woow_paas_platform.cloud_service`, ondelete='set null', index=True)
- [ ] `project.project` 移除 `workspace_id` 欄位
- [ ] `project.project` 新增 computed `workspace_id`，透過 `cloud_service_id.workspace_id` 取得（保持相容性）
- [ ] `cloud_service` 新增 `project_ids` (One2many → `project.project`, `cloud_service_id`)
- [ ] SQL constraint 確保一個 cloud service 最多一個 project
- [ ] `ir_rules.xml` 中 project 的 access rule 改為透過 `cloud_service_id.workspace_id.access_ids.user_id` 檢查
- [ ] Odoo module 可正常安裝/升級，無錯誤

## Technical Details

### 修改檔案

1. **`src/models/project_project.py`**
   - 移除 `workspace_id = fields.Many2one('woow_paas_platform.workspace', ...)`
   - 新增 `cloud_service_id = fields.Many2one('woow_paas_platform.cloud_service', string='Cloud Service', ondelete='set null', index=True)`
   - 新增 computed `workspace_id` 透過 `cloud_service_id.workspace_id` 以維持向下相容

2. **`src/models/cloud_service.py`**
   - 新增 `project_ids = fields.One2many('project.project', 'cloud_service_id', string='Support Projects')`
   - 新增 `_sql_constraints` 確保唯一性（或在 project 端加 unique constraint）

3. **`src/security/ir_rules.xml`**
   - 更新 project.project 的 domain rule，改為透過 `cloud_service_id.workspace_id` 檢查

4. **`src/security/ir.model.access.csv`**
   - 確認現有權限設定不受影響

## Dependencies

- [ ] Cloud Service 模型已存在（Phase 4 完成）
- [ ] project.project 模型已有 workspace_id（將被替換）

## Effort Estimate

- Size: S
- Hours: 3
- Parallel: true

## Definition of Done

- [ ] Code implemented (model + security)
- [ ] Deploy to local Odoo, module upgrade 成功
- [ ] 可建立 project 並關聯到 cloud service
- [ ] 一個 cloud service 不能有多個 project（constraint 生效）
