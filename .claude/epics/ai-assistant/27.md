---
name: Task Detail Page + Embedded Chat
status: closed
created: 2026-02-09T16:35:07Z
updated: 2026-02-10T06:11:51Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/27
depends_on: [24, 31]
parallel: false
conflicts_with: []
---

# Task: Task Detail Page + Embedded Chat

## Description

建立 `TaskDetailPage` 頁面，包含任務標題 + 狀態徽章、Info panel（Milestone、Assignees、Tags、Deadline 等）、分頁系統（Description / Sub-tasks / Chat）。Chat tab 嵌入 `AiChat` 元件，連接任務的 discuss.channel。

## Acceptance Criteria

- [ ] `TaskDetailPage.js` + `TaskDetailPage.xml` 建立
- [ ] 頁面頂部：
  - [ ] 任務標題（可編輯或僅顯示）
  - [ ] 狀態徽章（New / In Progress / Done）
  - [ ] 返回按鈕
- [ ] Info panel（右側或頂部）：
  - [ ] Milestone
  - [ ] Assignees（頭像列表）
  - [ ] Tags（彩色標籤）
  - [ ] Deadline（日期）
  - [ ] Customer
  - [ ] Company
- [ ] 分頁系統：
  - [ ] Description tab：顯示任務描述（HTML content）
  - [ ] Sub-tasks tab：子任務表格（標題、指派人、截止日、狀態）
  - [ ] Chat tab：嵌入 `AiChat` 元件
- [ ] Chat tab 整合：
  - [ ] 傳入 task 的 `channel_id` 給 AiChat
  - [ ] 若 channel 不存在，顯示「Enable Chat」按鈕觸發建立
  - [ ] `ai_auto_reply` toggle（auto / mention-only）
- [ ] `_task_detail.scss` 建立

## Technical Details

- 使用 `support_service.js` 的 `fetchTask(taskId)` 取得任務詳情
- 任務資料來自 `project.task`（透過 `/api/support/tasks/<task_id>` API）
- Tab 切換使用 OWL state（`activeTab` reactive property）
- AiChat 元件 props：`{ channelId: task.channel_id, autoReply: task.ai_auto_reply }`
- Enable Chat 按鈕呼叫 API 設定 `chat_enabled = True`，觸發後端 lazy channel creation
- 參考 `WorkspaceDetailPage.js` 的 tab 實作模式
- 參考設計圖中的 Task Detail 頁面

### Files affected

- `src/static/src/paas/pages/task-detail/TaskDetailPage.js` (create)
- `src/static/src/paas/pages/task-detail/TaskDetailPage.xml` (create)
- `src/static/src/paas/styles/pages/_task_detail.scss` (create)

## Dependencies

- [ ] Task 002: 需要 project.task 擴展（channel_id, chat_enabled 欄位）
- [ ] Task 005: 需要 AiChat 元件

## Effort Estimate

- Size: L
- Hours: 5-7
- Parallel: false (depends on AiChat component)

## Definition of Done

- [ ] Code implemented
- [ ] 任務詳情正確顯示（標題、狀態、info panel）
- [ ] 三個 tab 切換正常
- [ ] Description tab 顯示 HTML 內容
- [ ] Sub-tasks tab 顯示子任務表格
- [ ] Chat tab 成功嵌入 AiChat
- [ ] Enable Chat 功能正常
- [ ] auto_reply toggle 運作
