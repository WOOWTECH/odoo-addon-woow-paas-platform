---
name: Integration Testing + Polish
status: open
created: 2026-02-09T16:35:07Z
updated: 2026-02-09T16:35:07Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/30
depends_on: [22, 24, 25, 28, 31, 23, 26, 27, 29]
parallel: false
conflicts_with: []
---

# Task: Integration Testing + Polish

## Description
對整個 AI Assistant 功能進行端到端整合測試和最終打磨。驗證完整流程：Provider 設定 → 發送訊息 → AI 串流回覆 → 多人同步。完善錯誤處理、打磨 UI 細節、進行安全審查。

## Acceptance Criteria
- [ ] 端到端測試通過：
  - [ ] Provider 設定 → 連線測試通過
  - [ ] 建立任務 → 啟用 Chat → 發送訊息 → AI 串流回覆
  - [ ] @ mention agent → agent 角色回覆
  - [ ] 多人在同一 Chat → bus 即時同步
  - [ ] 附件上傳 + 顯示
- [ ] 錯誤處理完善：
  - [ ] API 連線失敗：顯示友善錯誤訊息
  - [ ] API Key 無效：提示檢查 Provider 設定
  - [ ] 串流中斷：graceful degradation
  - [ ] 超時處理：30 秒超時後提示重試
  - [ ] Network error：retry + error notification
- [ ] UI 打磨：
  - [ ] 對照設計圖驗證所有頁面 layout
  - [ ] Loading states 完整（skeleton + spinner）
  - [ ] Empty states 完整（所有列表頁）
  - [ ] Responsive layout（桌面 + 平板）
  - [ ] 動畫和過渡效果
- [ ] 安全審查：
  - [ ] API Key 不暴露到前端（檢查所有 API 回傳）
  - [ ] Workspace 權限隔離（跨 workspace 無法存取）
  - [ ] Channel access 權限驗證
  - [ ] XSS 防護（AI 回覆 HTML 處理）

## Technical Details
- 使用 Docker 開發環境測試（`./scripts/start-dev.sh`）
- 測試需要一組可用的 OpenAI compatible API（可用 local LLM 如 Ollama）
- Workspace 權限隔離測試：建立 2 個 workspace + 2 個使用者，驗證交叉存取被阻擋
- API Key 安全檢查：grep 所有 controller 回傳確保 api_key 不在 response 中
- XSS 檢查：AI 回覆中的 HTML/markdown 要正確 escape 或 sanitize

### Verification checklist
1. Provider 設定：Odoo 後台 Settings → Woow PaaS → 新增 AI Provider → 連線測試通過
2. 對話功能：/woow → AI Assistant → 開啟任務 Chat tab → 發送訊息 → AI 串流回覆
3. @ Mention：在 Chat 中輸入 `@` → 顯示 agent 列表 → 選擇後 AI 以該 agent 角色回覆
4. 多人聊天：多個 workspace 成員可在同一任務 Chat 中看到彼此和 AI 的訊息
5. 任務管理：Support Projects 列表 → 點入 → Tasks Kanban → 點入 Task Detail
6. Bus 通知：一個用戶發送訊息 → 其他 channel 成員即時收到更新

## Dependencies
- [ ] All previous tasks (001-009) completed

## Effort Estimate
- Size: M
- Hours: 4-6
- Parallel: false (final integration)

## Definition of Done
- [ ] 所有端到端場景測試通過
- [ ] 錯誤處理覆蓋所有邊界情況
- [ ] UI 對照設計圖無明顯差異
- [ ] 安全審查通過
- [ ] 無 console errors/warnings
