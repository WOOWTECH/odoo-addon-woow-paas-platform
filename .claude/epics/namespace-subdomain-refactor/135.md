---
name: Update all test suites for new naming format
status: open
created: 2026-03-01T14:57:06Z
updated: 2026-03-01T15:02:28Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/135
depends_on: [133, 134]
parallel: false
conflicts_with: []
---

# Task: Update all test suites for new naming format

## Description

更新所有測試檔案中的硬編碼命名值，使其符合新的 hash-based 格式。包含 namespace (`paas-ws-{hash}`)、service subdomain (`paas-cs-{hash}-{hash}`)、smart home subdomain (`paas-sm-{hash}-{hash}`) 和 tunnel name 相關的測試斷言。

## Acceptance Criteria

- [ ] `test_cloud_service.py` - 更新 `paas-ws-1` 等硬編碼 namespace/subdomain
- [ ] `test_cloud_api.py` - 更新硬編碼 namespace 和 subdomain uniqueness 測試
- [ ] `test_paas_operator.py` - 更新所有 `paas-ws-123` 硬編碼值
- [ ] `test_smart_home.py` - 更新 subdomain 格式驗證（`sh-` → `paas-sm-`）
- [ ] `test_ha_api.py` - 更新 subdomain 和 tunnel_name 相關測試值
- [ ] 所有測試通過（除已知 4 個 pre-existing `test_helm_values_filtering*` failures）
- [ ] 新增 naming.py 的單元測試

## Technical Details

### 修改清單

| 測試檔案 | 需修改的部分 |
|---------|------------|
| `src/tests/test_cloud_service.py:100,106` | `helm_namespace: 'paas-ws-1'` → hash format |
| `src/tests/test_cloud_api.py:105,112` | `helm_namespace: 'paas-ws-1'` → hash format |
| `src/tests/test_cloud_api.py:368-386` | subdomain uniqueness test values |
| `src/tests/test_paas_operator.py` | 所有 `paas-ws-123` → `paas-ws-{valid_hash}` |
| `src/tests/test_smart_home.py:48-56` | `sh-` prefix → `paas-sm-` prefix |
| `src/tests/test_smart_home.py:73-84` | subdomain uniqueness test values |
| `src/tests/test_smart_home.py:94,107` | tunnel_name format |
| `src/tests/test_ha_api.py:38,138` | subdomain test values |
| `src/tests/test_ha_api.py:198,214` | tunnel_name values |

### 新增測試

在 `src/tests/` 新增 `test_naming.py`：
- 測試 `generate_ws_hash` 的 deterministic 輸出
- 測試 `make_namespace` 格式
- 測試 `make_service_subdomain` 格式
- 測試 `make_smarthome_subdomain` 格式
- 測試輸出符合 K8s 命名限制

**Files affected:**
- `src/tests/test_cloud_service.py` (edit)
- `src/tests/test_cloud_api.py` (edit)
- `src/tests/test_paas_operator.py` (edit)
- `src/tests/test_smart_home.py` (edit)
- `src/tests/test_ha_api.py` (edit)
- `src/tests/test_naming.py` (new)

## Dependencies

- [ ] Task 002: Cloud service naming refactor complete
- [ ] Task 003: Smart home naming refactor complete

## Effort Estimate

- Size: M
- Hours: 1.0
- Parallel: false (must wait for Tasks 002 + 003)

## Definition of Done

- [ ] All hardcoded naming values updated
- [ ] New naming.py unit tests written
- [ ] All tests passing (except known 4 pre-existing failures)
