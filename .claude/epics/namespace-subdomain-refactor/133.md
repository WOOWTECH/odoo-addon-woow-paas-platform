---
name: Refactor cloud service namespace and subdomain naming
status: open
created: 2026-03-01T14:57:06Z
updated: 2026-03-01T15:02:28Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/133
depends_on: [132]
parallel: true
conflicts_with: []
---

# Task: Refactor cloud service namespace and subdomain naming

## Description

重構 `src/controllers/paas.py` 中 cloud service 部署的命名邏輯，將 namespace 從 `paas-ws-{workspace.id}` 改為 `paas-ws-{ws_hash}`，subdomain 從 `paas-{workspace.id}-{hash}` 改為 `paas-cs-{ws_hash}-{svc_hash}`。

## Acceptance Criteria

- [ ] Namespace 使用 `naming.make_namespace(workspace.slug)` 產生
- [ ] Subdomain 使用 `naming.make_service_subdomain(workspace.slug, reference_id, name)` 產生
- [ ] 新建 service 的 namespace 格式為 `paas-ws-{8hex}`
- [ ] 新建 service 的 subdomain 格式為 `paas-cs-{8hex}-{8hex}`
- [ ] Helm release name 不變（`svc-{reference_id[:8]}`）
- [ ] 已部署 service 的 namespace/subdomain 不受影響

## Technical Details

修改 `src/controllers/paas.py` 約 1093-1099 行：

```python
# Before
name_hash = hashlib.md5(salted_input.encode()).hexdigest()[:8]
subdomain = f"paas-{workspace.id}-{name_hash}"
helm_namespace = f"paas-ws-{workspace.id}"

# After
from ..services.naming import make_namespace, make_service_subdomain
subdomain = make_service_subdomain(workspace.slug, reference_id, name)
helm_namespace = make_namespace(workspace.slug)
```

可移除 controller 中的 `import hashlib`（如果不再直接使用）。

**Files affected:**
- `src/controllers/paas.py` (edit ~5 lines)

## Dependencies

- [ ] Task 001: naming utility module

## Effort Estimate

- Size: XS
- Hours: 0.25
- Parallel: true (can run in parallel with Task 003)

## Definition of Done

- [ ] Code implemented
- [ ] Service creation uses new naming format
- [ ] No import of hashlib directly in controller for naming
