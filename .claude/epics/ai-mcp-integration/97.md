---
name: MCP Server + Tool models, security, admin views, tool discovery
status: open
created: 2026-02-26T16:12:18Z
updated: 2026-02-26T16:22:04Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/97
depends_on: []
parallel: false
conflicts_with: []
---

# Task: MCP Server + Tool models, security, admin views, tool discovery

## Description

建立 MCP Server 和 MCP Tool 兩個 Odoo models，包含 CRUD 權限、admin form/list views、settings 整合，以及 MCP Server 的 tool discovery（sync）功能。

## Acceptance Criteria

- [ ] `woow_paas_platform.mcp_server` model 建立完成，含所有 PRD 定義的欄位
- [ ] `woow_paas_platform.mcp_tool` model 建立完成，含所有 PRD 定義的欄位
- [ ] `ir.model.access.csv` 加入兩個 model 的 CRUD 權限
- [ ] MCP Server form view：名稱、URL、transport type (sse/streamable_http)、API Key、headers、描述
- [ ] MCP Server list view：名稱、URL、state、tool 數量、last_sync
- [ ] Form view 有 "Sync Tools" button，點擊觸發 `action_sync_tools()`
- [ ] Form view 有 "Test Connection" button，點擊觸發 `action_test_connection()`
- [ ] `action_sync_tools()` 透過 `langchain-mcp-adapters` 的 `MultiServerMCPClient` 連接 MCP server，取得 tools 並寫入 `mcp_tool` records
- [ ] `action_test_connection()` 驗證 URL 可達並更新 `state` 欄位
- [ ] Settings → Woow PaaS 頁面有連結可進入 MCP Server 管理
- [ ] Menu 加入 MCP Servers 選項（在 Woow PaaS 選單下）

## Technical Details

### 新增檔案
- `src/models/mcp_server.py` — MCP Server model
- `src/models/mcp_tool.py` — MCP Tool model
- `src/views/mcp_server_views.xml` — Form + List views + Menu
- 更新 `src/models/__init__.py`
- 更新 `src/__manifest__.py`（data + depends）
- 更新 `src/security/ir.model.access.csv`
- 更新 `src/requirements.txt`（加入 `langchain-mcp-adapters`, `langgraph`）

### MCP Server Model 欄位

```python
class McpServer(models.Model):
    _name = 'woow_paas_platform.mcp_server'
    _description = 'MCP Server'

    name = fields.Char(required=True)
    url = fields.Char(string='Endpoint URL', required=True)
    transport = fields.Selection([
        ('sse', 'SSE'),
        ('streamable_http', 'Streamable HTTP'),
    ], default='sse', required=True)
    api_key = fields.Char(string='API Key', groups='base.group_system')
    headers_json = fields.Text(string='Custom Headers (JSON)')
    description = fields.Text()
    active = fields.Boolean(default=True)
    scope = fields.Selection([
        ('system', 'System'),
        ('user', 'User'),
    ], default='system', required=True)
    cloud_service_id = fields.Many2one('woow_paas_platform.cloud_service')
    tool_ids = fields.One2many('woow_paas_platform.mcp_tool', 'server_id')
    tool_count = fields.Integer(compute='_compute_tool_count')
    last_sync = fields.Datetime()
    state = fields.Selection([
        ('draft', 'Draft'),
        ('connected', 'Connected'),
        ('error', 'Error'),
    ], default='draft')
```

### Tool Discovery（async bridge）

```python
import asyncio
from langchain_mcp_adapters.client import MultiServerMCPClient

def action_sync_tools(self):
    asyncio.run(self._async_sync_tools())

async def _async_sync_tools(self):
    config = {self.name: self._get_mcp_client_config()}
    async with MultiServerMCPClient(config) as client:
        tools = await client.get_tools()
        # Create/update mcp_tool records from discovered tools
```

## Dependencies

- [ ] `langchain-mcp-adapters` pip package available
- [ ] `langgraph` pip package available

## Effort Estimate

- Size: L
- Hours: 8-10
- Parallel: false（基礎 task，其他都依賴此 task）

## Definition of Done

- [ ] Models 建立並可在 Odoo 後台 CRUD
- [ ] Sync Tools 能成功連接 MCP server 並 discover tools
- [ ] Test Connection 能正確更新 state
- [ ] Admin views 完整可操作
- [ ] Security CSV 正確
