---
name: Cloud Service user MCP servers (model + API + frontend)
status: closed
created: 2026-02-26T16:12:18Z
updated: 2026-02-26T16:22:04Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/100
depends_on: [97, 103]
parallel: true
conflicts_with: []
---

# Task: Cloud Service user MCP servers (model + API + frontend)

## Description

讓使用者可在 Cloud Service 設定頁面自定義 MCP Servers。包含 model 擴充、API endpoints、前端 MCP tab 的 CRUD UI。使用者定義的 MCP servers 只在該 Cloud Service 相關的對話中生效。

## Acceptance Criteria

- [ ] `cloud_service` model 擴充：新增 `user_mcp_server_ids` (One2many → mcp_server, scope=user)
- [ ] API: `GET /api/cloud-services/<id>/mcp-servers` — 列出使用者 MCP servers
- [ ] API: `POST /api/cloud-services/<id>/mcp-servers` — 新增使用者 MCP server
- [ ] API: `PUT /api/cloud-services/<id>/mcp-servers/<server_id>` — 更新
- [ ] API: `DELETE /api/cloud-services/<id>/mcp-servers/<server_id>` — 刪除
- [ ] API: `POST /api/cloud-services/<id>/mcp-servers/<server_id>/sync` — Sync tools
- [ ] 前端 ServiceDetailPage 新增 "MCP Servers" tab
- [ ] Tab 中顯示 MCP server 列表（name, url, state, tool count）
- [ ] 可新增 MCP server（填入 name, url, transport, api_key）
- [ ] 新增後自動 sync tools
- [ ] 可刪除 MCP server
- [ ] 每個 server 展開可看到 tool list + 個別開關
- [ ] 使用者 MCP scope 隔離：A 的 MCP 不出現在 B

## Technical Details

### 修改檔案
- `src/models/cloud_service.py` — 擴充 One2many 欄位
- `src/controllers/cloud_services.py` 或 `src/controllers/paas.py` — 新增 API endpoints
- `src/static/src/paas/pages/service/tabs/McpServersTab.js` — 新建 OWL component
- `src/static/src/paas/pages/service/tabs/McpServersTab.xml` — Template
- `src/static/src/paas/pages/service/ServiceDetailPage.js` — 新增 tab
- `src/static/src/paas/services/cloud_service.js` — 新增 API methods
- 更新 `src/__manifest__.py`

### Cloud Service Model 擴充

```python
class CloudService(models.Model):
    _inherit = 'woow_paas_platform.cloud_service'

    user_mcp_server_ids = fields.One2many(
        'woow_paas_platform.mcp_server',
        'cloud_service_id',
        string='User MCP Servers',
        domain=[('scope', '=', 'user')],
    )
```

### Frontend McpServersTab

參考 `ConfigurationTab` 的 read-only + edit 模式，但更簡單：

- 列表顯示 MCP servers（card layout）
- 每張 card: server name, url, state badge, tool count
- Add button → 展開 form（name, url, transport, api_key）
- 每張 card 可展開 tool list（toggle switch per tool）
- Delete button with confirmation

### API Pattern

遵循現有 collection/detail 模式：

```python
@http.route('/api/cloud-services/<int:service_id>/mcp-servers', type='json', auth='user')
def api_mcp_servers(self, service_id, action='list', **kw):
    # action: list, create

@http.route('/api/cloud-services/<int:service_id>/mcp-servers/<int:server_id>', type='json', auth='user')
def api_mcp_server_detail(self, service_id, server_id, action='get', **kw):
    # action: get, update, delete, sync
```

## Dependencies

- [ ] Task #97 完成（MCP Server model 存在）
- [ ] Task #103 完成（SSE controller 已整合 user tools 合併邏輯）

## Effort Estimate

- Size: L
- Hours: 10-12
- Parallel: true（可與 Task #98 並行，但需 Task #97 + #103 完成）

## Definition of Done

- [ ] API endpoints 完整可用
- [ ] 前端 MCP tab CRUD 正常
- [ ] Sync tools 正常
- [ ] Scope 隔離：不同 Cloud Service 的 MCP 互不影響
- [ ] 對話中 user MCP tools 正確合併
