---
name: Update n8n template data and create migration
status: open
created: 2026-02-15T10:59:32Z
updated: 2026-02-15T14:02:20Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/67
depends_on: [66]
parallel: false
conflicts_with: []
---

# Task: Update n8n template data and create migration

## Description
更新 `cloud_app_templates.xml` 中 n8n template 的 `helm_value_specs` 和 `helm_default_values`，建立 migration 腳本更新已存在的 n8n template 記錄，並將模組版本號升級至 `18.0.1.0.3`。

## Acceptance Criteria
- [ ] `helm_value_specs` 包含 2 個 required 欄位（Basic Auth User, Basic Auth Password）
- [ ] `helm_value_specs` 包含 3 個 optional 欄位（Database Type, Timezone, Log Level）
- [ ] `helm_default_values` 包含所有合理預設值，含 `N8N_BASIC_AUTH_ACTIVE: "true"`
- [ ] Migration 腳本 `src/migrations/18.0.1.0.3/post-migrate.py` 正確更新已存在的 n8n template
- [ ] `src/__manifest__.py` 版本號升級至 `18.0.1.0.3`
- [ ] Migration 不影響已部署的 n8n 服務實例

## Technical Details

### 修改檔案

1. **`src/data/cloud_app_templates.xml`** — 更新 n8n template：
   - `helm_value_specs`: 新增 required（basic auth user/password）和 optional（database type/timezone/log level）
   - `helm_default_values`: 包含 `N8N_BASIC_AUTH_ACTIVE: "true"`、timezone 預設 `Asia/Taipei`、log level 預設 `info`

2. **`src/migrations/18.0.1.0.3/post-migrate.py`** — 新增 migration：
   - 參考 `src/migrations/18.0.1.0.2/post-migrate.py` 的模式
   - 使用 `cr.execute` 更新 n8n template 的 `helm_value_specs` 和 `helm_default_values`
   - 透過 `name = 'n8n'` 或 XML ID 定位 n8n template 記錄

3. **`src/__manifest__.py`** — 版本號 `18.0.1.0.2` → `18.0.1.0.3`

### helm_value_specs 定義
```json
{
  "required": [
    {"key": "main.secret.N8N_BASIC_AUTH_USER", "label": "Basic Auth Username", "type": "text", "default": "admin"},
    {"key": "main.secret.N8N_BASIC_AUTH_PASSWORD", "label": "Basic Auth Password", "type": "password"}
  ],
  "optional": [
    {"key": "config.database.type", "label": "Database Type", "type": "select", "default": "sqlite", "options": ["sqlite", "postgres"]},
    {"key": "main.config.GENERIC_TIMEZONE", "label": "Timezone", "type": "select", "default": "Asia/Taipei", "options": ["Asia/Taipei", "Asia/Tokyo", "Asia/Shanghai", "Asia/Hong_Kong", "America/New_York", "America/Los_Angeles", "Europe/London", "UTC"]},
    {"key": "main.config.N8N_LOG_LEVEL", "label": "Log Level", "type": "select", "default": "info", "options": ["info", "warn", "error", "debug"]}
  ]
}
```

## Dependencies
- [ ] Task #66: dot-path key 驗證通過

## Effort Estimate
- Size: S
- Hours: 1-2
- Parallel: false（依賴 Task #66）

## Definition of Done
- [ ] XML data 更新完成
- [ ] Migration 腳本建立並可正確執行
- [ ] 版本號升級完成
- [ ] Code reviewed
