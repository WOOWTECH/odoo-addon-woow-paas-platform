---
name: "Backend: Extend _format_service to include helm_value_specs"
status: closed
created: 2026-02-14T16:16:38Z
updated: 2026-02-14T17:03:47Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/60
depends_on: []
parallel: false
conflicts_with: [002]
---

# Task: Backend — Extend _format_service to include helm_value_specs

## Description

在 `_format_service` 方法的 `include_details=True` 區塊中，擴充 template 欄位，將 `helm_value_specs` 加入 API response。這是前端重構的前置需求。

## Acceptance Criteria

- [ ] `_format_service(service, include_details=True)` 回傳的 `template` 物件包含 `helm_value_specs`
- [ ] `helm_value_specs` 為 parsed JSON object（非 string）
- [ ] template 無 `helm_value_specs` 時回傳 `{"required": [], "optional": []}`
- [ ] `helm_value_specs` JSON 格式錯誤時 fallback 為空 spec，不 crash

## Technical Details

**檔案**: `src/controllers/paas.py:1420` (`_format_service`)

修改 `include_details` 區塊中的 template dict：

```python
'template': {
    'id': service.template_id.id,
    'name': service.template_id.name,
    'category': service.template_id.category,
    'helm_value_specs': self._parse_helm_value_specs(service.template_id),
}
```

新增 helper method `_parse_helm_value_specs`：
```python
def _parse_helm_value_specs(self, template):
    if not template.helm_value_specs:
        return {'required': [], 'optional': []}
    try:
        return json.loads(template.helm_value_specs)
    except (json.JSONDecodeError, TypeError):
        return {'required': [], 'optional': []}
```

## Dependencies

- 無外部依賴

## Effort Estimate

- Size: XS
- Hours: 0.5
- Parallel: false（與 002 修改同一檔案）

## Definition of Done

- [ ] Code implemented
- [ ] API response 包含 helm_value_specs
- [ ] 無 spec 的 template 不會 crash
