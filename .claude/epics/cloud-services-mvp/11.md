---
name: Service Operations
status: closed
created: 2026-02-01T17:23:19Z
updated: 2026-02-02T01:47:36Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/11
depends_on: [10]
parallel: true
conflicts_with: [8, 9, 10, 12]
---

# Task: Service Operations

## Description

實現服務操作功能：Rollback、Delete、Edit Domain modals。

## Acceptance Criteria

- [x] DeleteServiceModal 建立（確認刪除）
- [x] RollbackModal 建立（選擇 revision）
- [x] EditDomainModal 建立（編輯自訂網域）
- [x] Delete 操作成功後導航回 workspace
- [x] Rollback 操作成功後刷新頁面
- [x] Domain 編輯成功後更新顯示

## Technical Details

### DeleteServiceModal (`src/static/src/paas/components/modal/`)

```
components/modal/
├── DeleteServiceModal.js
├── DeleteServiceModal.xml
└── DeleteServiceModal.scss
```

**內容:**
- 警告訊息
- 服務名稱確認輸入（輸入服務名稱才能刪除）
- Cancel / Delete 按鈕

**流程:**
1. 用戶點擊 Delete
2. 顯示確認 modal
3. 輸入服務名稱
4. 確認後呼叫 DELETE API
5. 顯示 deleting 狀態
6. 完成後導航回 workspace detail

### RollbackModal

```
components/modal/
├── RollbackModal.js
├── RollbackModal.xml
└── RollbackModal.scss
```

**內容:**
- Revision history 列表
- 每個 revision 顯示：number, date, description
- 選擇 revision
- Cancel / Rollback 按鈕

**API:**
```javascript
// 取得 revision history
const revisions = await cloudService.getRevisions(workspaceId, serviceId);
// [{ revision: 3, updated: 2026-02-01T17:39:37Z

// 執行 rollback
await cloudService.rollbackService(workspaceId, serviceId, revision);
```

### EditDomainModal

```
components/modal/
├── EditDomainModal.js
├── EditDomainModal.xml
└── EditDomainModal.scss
```

**內容:**
- 當前 subdomain（唯讀）
- Custom domain 輸入
- CNAME 設定說明
- Cancel / Save 按鈕

**CNAME 說明:**
```
To use a custom domain:
1. Add a CNAME record in your DNS settings
2. Point: yourdomain.com → my-app.woowtech.com
3. Changes may take up to 48 hours to propagate
```

### cloud_service.js 擴展

```javascript
async deleteService(workspaceId, serviceId) {
    return await jsonrpc(`/woow/api/workspaces/${workspaceId}/services/${serviceId}`, {}, 'DELETE');
},

async rollbackService(workspaceId, serviceId, revision) {
    return await jsonrpc(`/woow/api/workspaces/${workspaceId}/services/${serviceId}/rollback`, { revision });
},

async getRevisions(workspaceId, serviceId) {
    return await jsonrpc(`/woow/api/workspaces/${workspaceId}/services/${serviceId}/revisions`);
},

async updateDomain(workspaceId, serviceId, customDomain) {
    return await jsonrpc(`/woow/api/workspaces/${workspaceId}/services/${serviceId}`, { custom_domain: customDomain }, 'PATCH');
},
```

## Dependencies

- [ ] Task 006: ServiceDetailPage 完成

## Effort Estimate

- Size: S
- Hours: 4-6
- Parallel: true

## Definition of Done

- [x] Delete modal 正確顯示並執行刪除
- [x] Rollback modal 顯示 revision history
- [x] Rollback 執行成功並更新狀態
- [x] Domain 編輯成功並更新顯示
- [x] 所有 modal 有適當的載入狀態
- [x] 錯誤處理正確顯示錯誤訊息

## Implementation Summary

### Files Created

1. **DeleteServiceModal** (`src/static/src/paas/components/modal/`)
   - `DeleteServiceModal.js` - Modal logic with name confirmation
   - `DeleteServiceModal.xml` - Template with warning and confirm input
   - `DeleteServiceModal.scss` - Styles for confirm input

2. **RollbackModal** (`src/static/src/paas/components/modal/`)
   - `RollbackModal.js` - Modal logic with revision loading and selection
   - `RollbackModal.xml` - Template with revision list and radio selection
   - `RollbackModal.scss` - Styles for revision list items

3. **EditDomainModal** (`src/static/src/paas/components/modal/`)
   - `EditDomainModal.js` - Modal logic with domain validation
   - `EditDomainModal.xml` - Template with CNAME instructions
   - `EditDomainModal.scss` - Styles for domain input and CNAME display

### Files Modified

1. **cloud_service.js** - Added `getRevisions()` and `rollbackService()` methods
2. **ServiceDetailPage.js** - Imported and integrated modal components
3. **ServiceDetailPage.xml** - Replaced inline modals with component calls
