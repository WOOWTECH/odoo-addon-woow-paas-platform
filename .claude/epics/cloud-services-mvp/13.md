---
name: E2E Testing
status: closed
created: 2026-02-01T17:23:19Z
updated: 2026-02-02T01:52:36Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/13
depends_on: [8, 9, 10, 11, 12]
parallel: false
conflicts_with: []
---

# Task: E2E Testing

## Description

建立完整的端對端測試，涵蓋所有用戶流程、整合測試和錯誤處理。

## Acceptance Criteria

- [ ] PaaS Operator unit tests (pytest) 覆蓋率 > 80%
- [ ] PaaS Operator integration tests (mock Helm CLI)
- [ ] Odoo model unit tests
- [ ] Odoo API endpoint tests
- [ ] E2E user flow tests:
  - [ ] Browse Marketplace → Select App → Configure → Launch
  - [ ] View Service Detail → Edit Configuration → Verify Upgrade
  - [ ] Service Rollback flow
  - [ ] Service Delete flow
- [ ] Integration tests (Odoo ↔ PaaS Operator)
- [ ] Error handling tests
- [ ] Performance benchmarks

## Technical Details

### PaaS Operator Tests (`extra/paas-operator/tests/`)

**Unit Tests:**
```python
# test_helm.py
def test_install_release():
    """Test helm install wrapper"""
    pass

def test_upgrade_release():
    """Test helm upgrade wrapper"""
    pass

def test_uninstall_release():
    """Test helm uninstall wrapper"""
    pass

def test_rollback_release():
    """Test helm rollback wrapper"""
    pass

# test_api.py
def test_create_release_endpoint():
    """Test POST /api/releases"""
    pass

def test_get_release_endpoint():
    """Test GET /api/releases/{ns}/{name}"""
    pass
```

**Integration Tests (mock subprocess):**
```python
# test_integration.py
@patch('subprocess.run')
def test_full_deployment_flow(mock_run):
    """Test complete deployment flow with mocked Helm CLI"""
    mock_run.return_value = MockCompletedProcess(...)
    # Test namespace creation
    # Test release installation
    # Test status check
    pass
```

### Odoo Tests (`src/tests/`)

**Model Tests:**
```python
# test_cloud_app_template.py
class TestCloudAppTemplate(TransactionCase):
    def test_create_template(self):
        """Test creating a cloud app template"""
        pass

    def test_template_required_fields(self):
        """Test template required field validation"""
        pass

# test_cloud_service.py
class TestCloudService(TransactionCase):
    def test_create_service(self):
        """Test creating a cloud service"""
        pass

    def test_service_state_transitions(self):
        """Test valid state transitions"""
        pass
```

**API Tests:**
```python
# test_api.py
class TestCloudServiceAPI(HttpCase):
    def test_get_templates(self):
        """Test GET /woow/api/cloud/templates"""
        pass

    def test_create_service(self):
        """Test POST /woow/api/workspaces/{id}/services"""
        pass
```

### E2E User Flow Tests

使用 Odoo 的 tour 機制或 Playwright：

```javascript
// tests/tours/cloud_service_tour.js
registry.category("web_tour.tours").add("cloud_service_deploy", {
    steps: () => [
        {
            trigger: '.o_woow_empty_services button',
            run: 'click',
        },
        {
            trigger: '.o_woow_app_card:first .add-button',
            run: 'click',
        },
        {
            trigger: 'input[name="name"]',
            run: 'text My PostgreSQL',
        },
        // ... more steps
    ],
});
```

### Error Handling Tests

```python
# test_error_handling.py
def test_operator_connection_failure():
    """Test handling when PaaS Operator is unreachable"""
    pass

def test_helm_install_failure():
    """Test handling when helm install fails"""
    pass

def test_invalid_subdomain():
    """Test subdomain validation errors"""
    pass
```

### Performance Benchmarks

```python
# test_performance.py
def test_api_response_time():
    """API should respond in < 200ms"""
    start = time.time()
    response = self.url_open('/woow/api/cloud/templates')
    elapsed = time.time() - start
    self.assertLess(elapsed, 0.2)

def test_marketplace_load_time():
    """Marketplace should load in < 500ms"""
    pass
```

### Test Configuration

```ini
# pytest.ini (PaaS Operator)
[pytest]
testpaths = tests
python_files = test_*.py
addopts = --cov=src --cov-report=html --cov-fail-under=80
```

## Dependencies

- [ ] Task 004-008: 所有 UI 功能完成

## Effort Estimate

- Size: L
- Hours: 16-24
- Parallel: false (needs all features complete)

## Definition of Done

- [ ] PaaS Operator 測試覆蓋率 > 80%
- [ ] Odoo model 測試覆蓋率 > 80%
- [ ] 所有 E2E 流程測試通過
- [ ] 錯誤處理測試通過
- [ ] 效能基準測試通過
- [ ] CI pipeline 可執行所有測試
