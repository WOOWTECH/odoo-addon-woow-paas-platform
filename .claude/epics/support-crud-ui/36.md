---
name: CreateTaskModal + SupportTasksPage integration
status: open
created: 2026-02-10T06:44:22Z
updated: 2026-02-10T07:07:07Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/36
depends_on: [34]
parallel: true
conflicts_with: []
---

# Task: CreateTaskModal + SupportTasksPage integration

## Description

建立 `CreateTaskModal` 元件並整合到 `SupportTasksPage`。表單欄位比 Project 多（priority, deadline），但整體模式一致。呼叫已有的 `supportService.createTask()` 方法。

## Acceptance Criteria

- [ ] `CreateTaskModal.js` + `CreateTaskModal.xml` 建立完成
- [ ] Modal 包含欄位：Task Name（必填 text）、Description（選填 textarea）、Project（必填 select）、Priority（選填 select, 預設 0）、Deadline（選填 date input）
- [ ] Project 下拉選單從 `supportService.projects` 載入（需先 fetch）
- [ ] 必填欄位未填時顯示 inline error，不送出請求
- [ ] 提交時顯示 loading 狀態，按鈕 disabled
- [ ] 提交成功後呼叫 `onCreated` callback，Modal 自動關閉
- [ ] 提交失敗顯示錯誤訊息
- [ ] 點 backdrop / X 按鈕可關閉 Modal
- [ ] `SupportTasksPage` Header 右側有「+ New Task」`WoowButton`
- [ ] `SupportTasksPage` Empty State 有「Create your first task」`WoowButton`
- [ ] 點擊任一按鈕皆彈出 `CreateTaskModal`
- [ ] 建立成功後任務列表自動刷新（Kanban 更新）

## Technical Details

### CreateTaskModal 元件

```javascript
static props = {
    onClose: { type: Function },
    onCreated: { type: Function },
    defaultProjectId: { type: Number, optional: true },
};

setup() {
    this.state = useState({
        name: "",
        description: "",
        projectId: this.props.defaultProjectId || null,
        priority: "0",
        deadline: "",
        loading: false,
        error: null,
    });
    this.supportService = useState(supportService);
    onMounted(() => supportService.fetchAllProjects());
}
```

### Priority 選項

```javascript
get priorityOptions() {
    return [
        { value: "0", label: "Low" },
        { value: "1", label: "Normal" },
        { value: "2", label: "High" },
        { value: "3", label: "Urgent" },
    ];
}
```

### Task 建立需要 workspaceId

`createTask(workspaceId, data)` 需要 `workspaceId`。從選擇的 project 反查其 `workspace_id`：

```javascript
const project = this.supportService.projects.find(p => p.id === this.state.projectId);
const workspaceId = project?.workspace_id;
```

### SupportTasksPage 修改

1. 加入 `import { CreateTaskModal }` 和 `static components` 註冊
2. `state` 新增 `showCreateModal: false`
3. Header `o_woow_support_tasks_header_right` 加按鈕
4. Empty State 加 `WoowButton`
5. `onTaskCreated()` callback 呼叫 `_loadTasks()` 刷新列表

### Files affected

- `src/static/src/paas/components/modal/CreateTaskModal.js` (create)
- `src/static/src/paas/components/modal/CreateTaskModal.xml` (create)
- `src/static/src/paas/pages/support-tasks/SupportTasksPage.js` (edit)
- `src/static/src/paas/pages/support-tasks/SupportTasksPage.xml` (edit)

## Dependencies

- Task 001（`support_service.js` 需先有 project 列表可用，且 `createTask()` 已存在）

## Effort Estimate

- Size: S
- Hours: 1
- Parallel: true（與 Task 002 可並行，不衝突檔案）

## Definition of Done

- [ ] Modal 元件建立完成
- [ ] 頁面 Header + Empty State 按鈕整合完成
- [ ] Create → Kanban 刷新流程正常運作
