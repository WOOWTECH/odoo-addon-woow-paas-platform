---
name: CI/CD 模式支援
status: open
created: 2026-02-28T09:46:14Z
updated: 2026-02-28T09:54:37Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/124
depends_on: [121]
parallel: true
conflicts_with: []
---

# Task: CI/CD 模式支援

## Description

建立 CI/CD 模式所需的 Dockerfile.dev、values-ci.yaml，以及 create 腳本的 `--image` 參數支援。CI/CD 模式將 addon 程式碼 build 進 Docker image，不依賴 hostPath 掛載。

## Acceptance Criteria

- [ ] `Dockerfile.dev` 基於 `odoo:18.0`，COPY addon 程式碼
- [ ] `charts/odoo-dev-sandbox/values-ci.yaml` 覆蓋 CI 相關設定（mode: ci, 停用 hostPath, 設定 image tag）
- [ ] `k8s-sandbox-create.sh --image <tag>` 使用指定 image 部署（不掛載 hostPath）
- [ ] Image tag 格式：`woow-odoo-dev:{branch-slug}-{commit-short}`
- [ ] 提供 `scripts/k8s-sandbox-build.sh` 建置並推送 image

## Technical Details

**Dockerfile.dev**:
```dockerfile
FROM odoo:18.0
COPY src/ /mnt/extra-addons/woow_paas_platform/
COPY extra/extra-addons/ /mnt/extra-addons-ext/
COPY config/odoo/odoo.conf /etc/odoo/odoo.conf
```

**values-ci.yaml**:
```yaml
sandbox:
  mode: ci
odoo:
  image: registry.example.com/woow-odoo-dev:TAG
  devMode: false
```

**Build 腳本**:
```bash
BRANCH_SLUG=$(...)
COMMIT_SHORT=$(git rev-parse --short HEAD)
TAG="${BRANCH_SLUG}-${COMMIT_SHORT}"
docker build -f Dockerfile.dev -t woow-odoo-dev:${TAG} .
```

## Dependencies

- [ ] Task 001（Chart 基礎結構，values-ci.yaml 需要基礎 values.yaml）

## Effort Estimate

- Size: M
- Hours: 4-5
- Parallel: true（獨立於其他腳本 task）

## Definition of Done

- [ ] Dockerfile.dev 可成功 build
- [ ] values-ci.yaml 與 helm template 正確渲染
- [ ] `--image` 參數可正確切換部署模式
- [ ] Build 腳本可產生正確 tag 的 image
