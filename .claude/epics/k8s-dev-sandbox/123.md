---
name: 核心服務模板 (Odoo + PostgreSQL)
status: open
created: 2026-02-28T09:46:14Z
updated: 2026-02-28T09:54:37Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/123
depends_on: [001]
parallel: true
conflicts_with: [003]
---

# Task: 核心服務模板 (Odoo + PostgreSQL)

## Description

建立 Odoo Deployment 和 PostgreSQL StatefulSet 的 Helm 模板，包含 Service、PVC、ConfigMap。這是沙盒的核心服務層。

## Acceptance Criteria

- [ ] Odoo Deployment 模板支援 `local` 和 `ci` 兩種模式（hostPath vs image）
- [ ] Odoo ConfigMap 從 `odoo.conf.template` 模式產生正確的 Odoo 配置
- [ ] Odoo Service 暴露 port 8069 和 8072（WebSocket/longpolling）
- [ ] PostgreSQL StatefulSet 使用 PVC 持久化資料
- [ ] PostgreSQL Service 暴露 port 5432
- [ ] PVC 模板支援 `local` mode 的 hostPath 掛載（addon 程式碼）
- [ ] ResourceQuota 模板限制 namespace 資源上限
- [ ] `helm template` 正確渲染所有服務模板

## Technical Details

**Odoo Deployment**:
- image: `{{ .Values.odoo.image }}`（預設 `odoo:18.0`）
- 環境變數：DB_HOST, DB_PORT, DB_USER, DB_PASSWORD（從 Secret 引用）
- Volume mounts：
  - Local mode: hostPath → `/mnt/extra-addons/woow_paas_platform` 和 `/mnt/extra-addons-ext`
  - CI mode: 無額外掛載（程式碼已在 image 內）
- ConfigMap mount → `/etc/odoo/odoo.conf`
- 開發模式：`--dev reload,qweb,xml`

**PostgreSQL StatefulSet**:
- image: `{{ .Values.postgres.image }}`（預設 `postgres:15`）
- PVC: 5Gi（可配置）
- 環境變數：POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB（從 Secret 引用）
- Readiness probe: `pg_isready`

**Odoo ConfigMap**:
- 沿用 `config/odoo/odoo.conf.template` 的設定模式
- addons_path, dev_mode, proxy_mode, workers, limits

## Dependencies

- [ ] Task 001（Chart 基礎結構）

## Effort Estimate

- Size: L
- Hours: 6-8
- Parallel: true（可與 Task 003 並行，但修改同一 chart）

## Definition of Done

- [ ] Odoo Deployment + Service 模板完成
- [ ] PostgreSQL StatefulSet + Service 模板完成
- [ ] PVC 模板完成（支援 local/ci mode 切換）
- [ ] ConfigMap 模板完成
- [ ] ResourceQuota 模板完成
- [ ] `helm template` 通過驗證
