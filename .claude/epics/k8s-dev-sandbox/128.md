---
name: 測試執行命令
status: open
created: 2026-02-28T09:46:14Z
updated: 2026-02-28T09:54:37Z
github: https://github.com/WOOWTECH/odoo-addon-woow-paas-platform/issues/128
depends_on: [127]
parallel: true
conflicts_with: []
---

# Task: 測試執行命令

## Description

建立 `scripts/k8s-sandbox-test.sh`，在沙盒的 Odoo Pod 中執行測試套件，擷取結果並回報。

## Acceptance Criteria

- [ ] `k8s-sandbox-test.sh <name>` 在指定沙盒中執行 Odoo 測試
- [ ] 預設測試 `woow_paas_platform` module
- [ ] 支援 `--module <name>` 指定測試模組
- [ ] 測試結果（pass/fail）以 exit code 回報
- [ ] 測試日誌輸出到 stdout
- [ ] 支援 `--keep-on-fail` 測試失敗時保留沙盒（延長 TTL）

## Technical Details

```bash
kubectl exec -n $NAMESPACE deploy/odoo -- odoo \
  --test-enable \
  --test-tags $MODULE \
  --stop-after-init \
  --log-level=test \
  -d $DB_NAME
```

**Exit code 處理**:
- 0: 全部通過
- 1: 有失敗
- 2: 環境錯誤（Pod 不存在等）

**--keep-on-fail**:
```bash
if [ $exit_code -ne 0 ] && [ "$KEEP_ON_FAIL" = true ]; then
  ./scripts/k8s-sandbox-extend.sh $NAME --ttl 24h
  echo "⚠️ 測試失敗，沙盒已延長 24h 供除錯"
fi
```

## Dependencies

- [ ] Task 004（create 腳本，需要已建立的沙盒）

## Effort Estimate

- Size: S
- Hours: 2-3
- Parallel: true（可與 Task 005, 122 並行）

## Definition of Done

- [ ] 測試腳本可在沙盒中成功執行 Odoo 測試
- [ ] Exit code 正確反映測試結果
- [ ] --keep-on-fail 正常工作
