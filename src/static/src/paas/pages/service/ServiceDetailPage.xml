<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="woow_paas_platform.ServiceDetailPage">
        <div class="o_woow_service_detail">
            <!-- Loading State -->
            <t t-if="state.loading">
                <div class="o_woow_loading">
                    <WoowIcon name="'sync'" size="32" class="'o_woow_spin'"/>
                    <p>Loading service...</p>
                </div>
            </t>

            <!-- Error State -->
            <t t-elif="state.error">
                <div class="o_woow_error_state">
                    <WoowIcon name="'error'" size="48"/>
                    <h2>Unable to load service</h2>
                    <p t-esc="state.error"/>
                    <WoowButton variant="'primary'" size="'md'" onClick.bind="goBack">
                        <WoowIcon name="'arrow_back'" size="18"/>
                        Back to Workspace
                    </WoowButton>
                </div>
            </t>

            <!-- Service Content -->
            <t t-elif="service">
                <!-- Breadcrumb / Back Navigation -->
                <div class="o_woow_breadcrumb">
                    <button class="o_woow_back_btn" t-on-click="goBack">
                        <WoowIcon name="'arrow_back'" size="20"/>
                    </button>
                    <span class="o_woow_breadcrumb_sep">/</span>
                    <span class="o_woow_breadcrumb_parent o_woow_breadcrumb_link" t-on-click="goBack">Services</span>
                    <span class="o_woow_breadcrumb_sep">/</span>
                    <span class="o_woow_breadcrumb_current" t-esc="service.name"/>
                </div>

                <!-- Service Header -->
                <div class="o_woow_service_header">
                    <div class="o_woow_service_header_info">
                        <div class="o_woow_service_header_icon">
                            <WoowIcon name="templateIcon" size="32"/>
                        </div>
                        <div class="o_woow_service_header_text">
                            <div class="o_woow_service_header_title">
                                <h1 t-esc="service.name"/>
                                <StatusBadge status="service.state"/>
                            </div>
                            <div class="o_woow_service_header_meta">
                                <span class="o_woow_service_template">
                                    <WoowIcon name="'apps'" size="14"/>
                                    <t t-esc="service.template?.name || 'Unknown Template'"/>
                                </span>
                                <span t-if="service.subdomain" class="o_woow_service_domain">
                                    <WoowIcon name="'language'" size="14"/>
                                    <t t-esc="service.subdomain"/>.<t t-esc="domain"/>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="o_woow_service_header_actions">
                        <!-- Support Project Button -->
                        <WoowButton
                            t-if="state.supportProject"
                            variant="'secondary'"
                            size="'md'"
                            onClick.bind="openSupportProject">
                            <WoowIcon name="'support_agent'" size="18"/>
                            Support Project
                        </WoowButton>
                        <WoowButton
                            t-elif="!state.supportProjectLoading"
                            variant="'secondary'"
                            size="'md'"
                            onClick.bind="showCreateProject">
                            <WoowIcon name="'add_circle'" size="18"/>
                            Create Support Project
                        </WoowButton>
                        <WoowButton
                            t-if="service.state === 'running'"
                            variant="'primary'"
                            size="'md'"
                            onClick.bind="openWebUI">
                            <WoowIcon name="'open_in_new'" size="18"/>
                            Open Web UI
                        </WoowButton>
                        <WoowButton
                            variant="'secondary'"
                            size="'md'"
                            onClick.bind="showDomainModal"
                            disabled="!canPerformActions">
                            <WoowIcon name="'language'" size="18"/>
                            Domain
                        </WoowButton>
                        <WoowButton
                            variant="'secondary'"
                            size="'md'"
                            onClick.bind="showRollback"
                            disabled="!canPerformActions">
                            <WoowIcon name="'history'" size="18"/>
                            Rollback
                        </WoowButton>
                        <WoowButton
                            variant="'ghost'"
                            size="'md'"
                            onClick.bind="showDelete"
                            disabled="!canPerformActions">
                            <WoowIcon name="'delete'" size="18"/>
                        </WoowButton>
                    </div>
                </div>

                <!-- Error Message Banner -->
                <div t-if="service.error_message" class="o_woow_service_error_banner">
                    <WoowIcon name="'error'" size="20"/>
                    <span t-esc="service.error_message"/>
                </div>

                <!-- Tab Navigation -->
                <div class="o_woow_tabs">
                    <button
                        t-att-class="{'o_woow_tab': true, 'active': currentTab === 'overview'}"
                        t-on-click="() => this.setTab('overview')">
                        <WoowIcon name="'info'" size="18"/>
                        Overview
                    </button>
                    <button
                        t-att-class="{'o_woow_tab': true, 'active': currentTab === 'configuration'}"
                        t-on-click="() => this.setTab('configuration')">
                        <WoowIcon name="'settings'" size="18"/>
                        Configuration
                    </button>
                    <button
                        t-att-class="{'o_woow_tab': true, 'active': currentTab === 'mcp-servers'}"
                        t-on-click="() => this.setTab('mcp-servers')">
                        <WoowIcon name="'extension'" size="18"/>
                        MCP Servers
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="o_woow_tab_content">
                    <OverviewTab
                        t-if="currentTab === 'overview'"
                        service="service"/>
                    <ConfigurationTab
                        t-if="currentTab === 'configuration'"
                        service="service"
                        workspaceId="props.workspaceId"
                        onSave.bind="handleConfigSave"/>
                    <McpServersTab
                        t-if="currentTab === 'mcp-servers'"
                        service="service"
                        workspaceId="props.workspaceId"/>
                </div>
            </t>

            <!-- Delete Service Modal -->
            <DeleteServiceModal
                t-if="state.showDeleteModal and serviceForModal"
                service="serviceForModal"
                onClose.bind="hideDelete"
                onDeleted.bind="onServiceDeleted"/>

            <!-- Rollback Modal -->
            <RollbackModal
                t-if="state.showRollbackModal and serviceForModal"
                service="serviceForModal"
                onClose.bind="hideRollback"
                onRollback.bind="onRollbackComplete"/>

            <!-- Edit Domain Modal -->
            <EditDomainModal
                t-if="state.showDomainModal and serviceForModal"
                service="serviceForModal"
                onClose.bind="hideDomainModal"
                onSaved.bind="onDomainSaved"/>

            <!-- Create Support Project Modal -->
            <CreateProjectModal
                t-if="state.showCreateProjectModal"
                workspaceId="props.workspaceId"
                cloudServiceId="props.serviceId"
                cloudServiceName="service and service.name"
                onClose.bind="hideCreateProject"
                onCreated.bind="onProjectCreated"/>
        </div>
    </t>
</templates>
