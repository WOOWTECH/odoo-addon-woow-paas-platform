<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="woow_paas_platform.WorkspaceDetailPage">
        <div class="o_woow_workspace_detail">
            <!-- Loading State -->
            <t t-if="state.loading">
                <div class="o_woow_loading">
                    <WoowIcon name="'sync'" size="32" class="'o_woow_spin'"/>
                    <p>Loading workspace...</p>
                </div>
            </t>

            <!-- Error State -->
            <t t-elif="state.error">
                <div class="o_woow_error_state">
                    <WoowIcon name="'error'" size="48"/>
                    <h2>Unable to load workspace</h2>
                    <p t-esc="state.error"/>
                    <WoowButton variant="'primary'" size="'md'" onClick.bind="goBack">
                        <WoowIcon name="'arrow_back'" size="18"/>
                        Back to Workspaces
                    </WoowButton>
                </div>
            </t>

            <!-- Workspace Content -->
            <t t-elif="workspace">
                <!-- Breadcrumb / Back Navigation -->
                <div class="o_woow_breadcrumb">
                    <button class="o_woow_back_btn" t-on-click="goBack">
                        <WoowIcon name="'arrow_back'" size="20"/>
                    </button>
                    <span class="o_woow_breadcrumb_sep">/</span>
                    <span class="o_woow_breadcrumb_parent">Workspaces</span>
                    <span class="o_woow_breadcrumb_sep">/</span>
                    <span class="o_woow_breadcrumb_current" t-esc="workspace.name"/>
                </div>

                <!-- Header Section -->
                <div class="o_woow_workspace_detail_header">
                    <div class="o_woow_workspace_detail_info">
                        <div class="o_woow_workspace_detail_icon">
                            <WoowIcon name="'folder'" size="28"/>
                        </div>
                        <div>
                            <div class="o_woow_workspace_detail_title">
                                <h1 t-esc="workspace.name"/>
                                <span t-att-class="'o_woow_badge ' + getRoleBadgeClass(workspace.role)">
                                    <t t-esc="workspace.role"/>
                                </span>
                            </div>
                            <p t-if="workspace.description" class="o_woow_workspace_detail_desc" t-esc="workspace.description"/>
                            <div class="o_woow_workspace_detail_meta">
                                <span>
                                    <WoowIcon name="'group'" size="14"/>
                                    <t t-esc="workspace.member_count"/> members
                                </span>
                                <span>
                                    <WoowIcon name="'schedule'" size="14"/>
                                    Created <t t-esc="formatDate(workspace.created_date)"/>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="o_woow_workspace_detail_actions">
                        <WoowButton variant="'secondary'" size="'md'" onClick.bind="goToTeam">
                            <WoowIcon name="'group'" size="18"/>
                            Team
                        </WoowButton>
                        <WoowButton variant="'secondary'" size="'md'" onClick.bind="goToSettings">
                            <WoowIcon name="'settings'" size="18"/>
                            Settings
                        </WoowButton>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="o_woow_stats_grid">
                    <t t-foreach="computedStats" t-as="stat" t-key="stat.label">
                        <WoowCard class="'o_woow_stat_mini_card'">
                            <div class="o_woow_stat_mini_content">
                                <div t-att-class="'o_woow_stat_mini_icon o_woow_stat_mini_icon_' + stat.color">
                                    <WoowIcon name="stat.icon" size="20"/>
                                </div>
                                <div class="o_woow_stat_mini_info">
                                    <span class="o_woow_stat_mini_value" t-esc="stat.value"/>
                                    <span class="o_woow_stat_mini_label" t-esc="stat.label"/>
                                </div>
                            </div>
                        </WoowCard>
                    </t>
                </div>

                <!-- Cloud Services Section -->
                <section class="o_woow_services_section">
                    <div class="o_woow_services_section_header">
                        <h2>Cloud Services</h2>
                        <WoowButton
                            variant="'primary'"
                            size="'md'"
                            onClick.bind="goToMarketplace">
                            <WoowIcon name="'add'" size="18"/>
                            Add Service
                        </WoowButton>
                    </div>

                    <!-- Loading Services -->
                    <t t-if="state.loadingServices and !hasServices">
                        <div class="o_woow_services_loading">
                            <WoowIcon name="'sync'" size="24" class="'o_woow_spin'"/>
                            <p>Loading services...</p>
                        </div>
                    </t>

                    <!-- Empty State -->
                    <t t-elif="!hasServices and !state.loadingServices">
                        <div class="o_woow_empty_services">
                            <WoowIcon name="'cloud_upload'" size="48"/>
                            <h3>Get Started: Deploy Your First Service</h3>
                            <p>Launch containerized applications like databases, automation tools, and more with one click.</p>
                            <WoowButton
                                variant="'primary'"
                                size="'md'"
                                onClick.bind="goToMarketplace">
                                <WoowIcon name="'explore'" size="18"/>
                                Browse Marketplace
                            </WoowButton>
                        </div>
                    </t>

                    <!-- Service Grid -->
                    <t t-if="hasServices">
                        <div class="o_woow_cloud_services_grid">
                            <t t-foreach="state.services" t-as="service" t-key="service.id">
                                <ServiceCard
                                    service="service"
                                    onOpen="() => this.openService(service.id)"
                                    onSettings="() => this.goToService(service.id)"/>
                            </t>
                        </div>
                    </t>
                </section>

                <!-- Smart Home Section -->
                <section class="o_woow_smart_homes_section">
                    <div class="o_woow_smart_homes_section_header">
                        <h2>Smart Home</h2>
                        <WoowButton
                            variant="'primary'"
                            size="'md'"
                            onClick.bind="openCreateSmartHomeModal">
                            <WoowIcon name="'add'" size="18"/>
                            Add Smart Home
                        </WoowButton>
                    </div>

                    <!-- Loading Smart Homes -->
                    <t t-if="state.loadingSmartHomes and !hasSmartHomes">
                        <div class="o_woow_services_loading">
                            <WoowIcon name="'sync'" size="24" class="'o_woow_spin'"/>
                            <p>Loading smart homes...</p>
                        </div>
                    </t>

                    <!-- Empty State -->
                    <t t-elif="!hasSmartHomes and !state.loadingSmartHomes">
                        <div class="o_woow_smart_homes_empty">
                            <WoowIcon name="'home_iot_device'" size="48"/>
                            <h3>Connect Your Home Assistant</h3>
                            <p>Set up a secure tunnel to access your Home Assistant from anywhere.</p>
                            <WoowButton
                                variant="'primary'"
                                size="'md'"
                                onClick.bind="openCreateSmartHomeModal">
                                <WoowIcon name="'add'" size="18"/>
                                Add Smart Home
                            </WoowButton>
                        </div>
                    </t>

                    <!-- Smart Home Grid -->
                    <t t-if="hasSmartHomes">
                        <div class="o_woow_smart_homes_grid">
                            <t t-foreach="state.smartHomes" t-as="home" t-key="home.id">
                                <SmartHomeCard
                                    home="home"
                                    domain="state.domain"
                                    onSelect="() => this.goToSmartHome(home.id)"/>
                            </t>
                        </div>
                    </t>
                </section>

                <!-- Create Smart Home Modal -->
                <CreateSmartHomeModal
                    t-if="state.showCreateSmartHomeModal"
                    workspaceId="props.workspaceId"
                    onClose.bind="closeCreateSmartHomeModal"
                    onCreated.bind="onSmartHomeCreated"/>

                <!-- Get Started Section (Service Types) -->
                <WoowCard shadow="true" class="'o_woow_get_started'">
                    <div class="o_woow_get_started_header">
                        <WoowIcon name="'rocket_launch'" size="32" class="'o_woow_rocket_icon'"/>
                        <div>
                            <h2>Explore More Services</h2>
                            <p>Choose a service type below to begin setting up your infrastructure.</p>
                        </div>
                    </div>

                    <div class="o_woow_service_grid">
                        <t t-foreach="serviceTypes" t-as="service" t-key="service.name">
                            <div t-att-class="'o_woow_service_card o_woow_service_card_' + service.color">
                                <div class="o_woow_service_icon">
                                    <WoowIcon name="service.icon" size="32"/>
                                </div>
                                <h3><t t-esc="service.name"/></h3>
                                <p><t t-esc="service.description"/></p>
                                <t t-if="service.action === 'smarthome'">
                                    <WoowButton variant="'primary'" size="'sm'" onClick.bind="openCreateSmartHomeModal">
                                        Get Started
                                        <WoowIcon name="'arrow_forward'" size="16"/>
                                    </WoowButton>
                                </t>
                                <t t-else="">
                                    <WoowButton variant="'primary'" size="'sm'" onClick.bind="goToMarketplace">
                                        Get Started
                                        <WoowIcon name="'arrow_forward'" size="16"/>
                                    </WoowButton>
                                </t>
                            </div>
                        </t>
                    </div>
                </WoowCard>
            </t>
        </div>
    </t>
</templates>
