apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "odoo-dev-sandbox.fullname" . }}-odoo-config
  namespace: {{ include "odoo-dev-sandbox.namespace" . }}
  labels:
    {{- include "odoo-dev-sandbox.labels" . | nindent 4 }}
    app.kubernetes.io/component: odoo
data:
  odoo.conf: |
    [options]
    ; Odoo 18 Configuration - Generated by Helm

    ; Database settings
    db_host = {{ include "odoo-dev-sandbox.fullname" . }}-postgres
    db_port = 5432
    db_user = {{ .Values.postgres.user }}
    db_password = {{ .Values.postgres.password }}
    db_name = False
    db_template = template0
    db_maxconn = 64

    ; Addons path
    addons_path = {{ .Values.odoo.addonsPath }}

    ; Server settings
    http_port = 8069
    http_interface = 0.0.0.0
    proxy_mode = True

    ; Performance settings
    workers = 0
    max_cron_threads = 1
    limit_memory_hard = 2684354560
    limit_memory_soft = 2147483648
    limit_time_cpu = 600
    limit_time_real = 1200

    ; Logging
    log_level = info
    log_handler = :INFO

    ; Development mode
    {{- if .Values.odoo.devMode }}
    dev_mode = reload,qweb,xml
    {{- else }}
    ; dev_mode disabled
    {{- end }}

    ; Security
    admin_passwd = {{ .Values.odoo.adminPassword }}
    list_db = True
